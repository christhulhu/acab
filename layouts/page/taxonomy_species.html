{{ define "main" }}
<article class="markdown">
  {{ partial "docs/post-meta" . }}

  {{$datafile := .Page.Param "datafile"}}
  {{$genus := lower (.Page.Param "genus")}}
  {{$data := index .Site.Data.species $genus $datafile }}
  {{$distribution := dict "asia" "Asien" "europe" "Europa" "america" "Amerika" "africa" "Africa" "oceania" "Australien/Ozeanien"}}

  <h1>{{$data.name}} <small>({{$data.first_description}})</small></h1>

  {{- .Content -}}
  
  <h2>Taxonomie</h2>
  Klasse: {{ $data.taxonomy.class }}<br>
  Ordnung: {{ $data.taxonomy.order }}<br>
  Familie: {{ $data.taxonomy.family }}<br>
  Unterfamilie: {{ $data.taxonomy.sub_family }}<br>
  Gattung: {{ $data.taxonomy.genus }}<br>

  {{with $data.sub_species}}
    <h2>Unterarten</h2>
    {{range sort . "name"}}
    {{.name}} ({{.first_description}})<br/>
    {{end}}
  {{end}}

  {{with $data.variations}}
    <h2>Variationen</h2>
    {{range sort . "name"}}
    {{.name}} ({{.first_description}})<br/>
    {{end}}
  {{end}}

  {{with $data.distribution}}
    <h2>Verbreitung</h2>
    {{range $key, $value := . }}
    <strong>{{index $distribution $key}}</strong>: {{delimit (sort $value) ", "}}<br/>
    <br/>
    {{end}}
  {{end}}

  {{with $data.publications}}
    <h2>Publikationen</h2>
    <ul class="publications">
    {{range sort . "year" "desc"}}
      <li>
        <div class="publication">
          <div class="title">{{.title}}</div>
          <div class="meta">({{.year}}, {{.author}})<br/>

            <div class="links">
              {{with .download}}<a href="{{.}}">Download</a>{{end}}<br/>
              {{with .doi}}DOI: <a href="{{.}}">{{.}}</a>{{end}}
            </div>
          </div>
        </div>
      </li>
    {{end}}
    </ul>
  {{end}}

  {{with $data.synonyms}}
    <h2>Synonyme</h2>
    {{range sort . "name"}}
    {{.name}} ({{.first_description}})<br/>
    {{end}}
  {{end}}
  
</article>
{{ end }}

{{ define "toc" }}
  {{ partial "docs/toc" . }}
{{ end }}
